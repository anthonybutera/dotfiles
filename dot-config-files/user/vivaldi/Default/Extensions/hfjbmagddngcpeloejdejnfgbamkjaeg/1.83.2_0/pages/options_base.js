"use strict";var t,u,s,w,x,y,O,R,S,N,_,J,P;t=function(t){return document.querySelector(t)},u=chrome.extension.getBackgroundPage(),s=chrome.i18n.getMessage,w=document.querySelectorAll.bind(document),(x=chrome.i18n.getMessage("lang1"))&&(function(){var n,i,e,o,u=s("keyMappingsP"),r=t("#keyMappings");for(u&&r&&(r.placeholder=u),n=0,i=w("[data-i]");n<i.length;n++)((u=s((r=i[n]).dataset.i))||r.dataset.iE)&&(r.innerText=u);for(e=0,o=w("[data-i-t]");e<o.length;e++)(u=s((r=o[e]).dataset.iT))&&(r.title=u);document.documentElement.lang=x,(u=s("vOptions"))&&(document.title=u)})(),y=function(t,n){var i=function(){this.constructor=t};i.prototype=n.prototype,t.prototype=new i},O=(function(){var t=[],n=function(){var i,e,o=t.length;for(i=0,e=t;i<e.length;i++)(0,e[i])();t.length>o?(t.splice(0,o),Promise.resolve().then(n)):t.length=0};return function(i,e){t.length<=0&&Promise.resolve().then(n),9===e?t.unshift(i):t.push(e?i.bind(null,e):i)}})(),R=function(t,n,i,e){var o,u=0,r=function(){var s=Date.now()-o;if(!(s<n-4&&s>=0))return u=0,o!==e?t.call(i):void 0;u=setTimeout(r,n-s)};return e=e?1:0,function(){if(o=Date.now(),!u)return u=setTimeout(r,n),e?(e=o,t.call(i)):void 0}},S=u.f,N=u.l,_=(function(){function t(t,n){this.tu=t,this.nu=t.id,this.iu=this.eu=null,this.ou=false,this.nu in N.ge&&(n=this.uu.bind(this,n)),this.eu=R(n,330,this,1)}return t.prototype.ru=function(){},t.prototype.su=function(){this.ou=true,this.iu=N.de(this.nu),t.cu||this.au(this.iu)},t.prototype.lu=function(t,n,i){var e=this.fu;return n?(i=e||!i?JSON.stringify(e?e.hu(t):t):i,u.JSON.parse(i)):e?e.hu(t):t},t.prototype.du=function(){return true},t.prototype.vu=function(){var n=this.mu(),i="object"==typeof n,e=i?JSON.stringify(this.iu):this.iu,o=i?JSON.stringify(n):n;o!==e&&(e=o,n=this.lu(n,i,i?o:""),i&&(o=JSON.stringify(n))===JSON.stringify(N.me[this.nu])&&(n=N.me[this.nu]),N.he(this.nu,n),this.iu=n=N.de(this.nu),this.ou=true,(e!==(i?JSON.stringify(n):n)||this.pu(n))&&this.au(n,true),this.nu in N.ge&&t.wu.push(this.nu),this.ru())},t.prototype.pu=function(){return false},t.xu=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},t.Po=Object.create(null),t.cu=true,t})(),J=(function(n){function i(e,o){var u,r,c,a,l,f,h=n.call(this,e,o)||this;if(h.yu=_.xu,h.N=e.querySelector("#exclusionTemplate").content.firstChild,x){for(u=void 0,r=void 0,c=0,a=e.querySelectorAll("[data-i]");c<a.length;c++)(r=s((u=a[c]).dataset.i))&&(u.innerText=r);for(l=0,f=h.N.querySelectorAll("[title]");l<f.length;l++)(r=s((u=f[l]).title))&&(u.title=r)}return h.gu=e.querySelector("tbody"),h.$t=[],h.gu.addEventListener("input",i.Ou),h.gu.addEventListener("input",h.eu),h.gu.addEventListener("click",function(t){return h.bu(t)}),t("#exclusionAddButton").onclick=function(){return h.ku("")},_.wu&&(h.N.draggable=true),O(function(){return h.Ru&&h.Ru()}),h}return y(i,n),i.prototype.Su=function(){},i.Ou=function(t){var n=t.target.vnode;n&&(n.Nu=true)},i.prototype.ku=function(t,n){this._u(this.gu,{pattern:t,passKeys:""});var i=this.$t[this.$t.length-1];false!==n&&O(function(){return i.Ju.focus()}),t&&this.eu(),this.Su(1)},i.prototype.au=function(t){if(this.gu.textContent="",this.$t=[],t.length<=0);else if(1===t.length)this._u(this.gu,t[0]);else{var n=document.createDocumentFragment();t.forEach(this._u.bind(this,n)),this.gu.appendChild(n)}return this.Su(t.length)},i.prototype.Pu=function(){return true},i.prototype._u=function(t,n){var i,e,o,u,r,s=n.pattern,c=n.passKeys,a={Tu:{pattern:s,passKeys:c},Nu:false,gi:false,Ju:null,$u:null};this.Pu(s)?(e=(i=document.importNode(this.N,true)).querySelector(".pattern"),o=i.querySelector(".passKeys"),u=c.trimRight(),e.value=s,s&&(e.placeholder=""),o.value=u,u&&(o.placeholder=""),(r=a).gi=true,r.Ju=e,r.$u=o,e.vnode=r,o.vnode=r,this.$t.push(r),t.appendChild(i)):this.$t.push(a)},i.ju=function(t){t.Tu.pattern&&t.$u.placeholder&&(t.$u.placeholder="")},i.prototype.bu=function(t){var n,i=t.target;if(i.classList.contains("exclusionRemove"))return(i=i.parentNode.parentNode).classList.contains("exclusionRule")?(n=i.querySelector(".pattern").vnode,i.remove(),this.$t.splice(this.$t.indexOf(n),1),this.eu(),this.Su(0)):void 0},i.prototype.mu=function(t){var n,i,e,o,r,s,c,a,l,f,h=[];for(t=true===t,n=0,i=this.$t;n<i.length;n++)e=i[n],t&&!e.gi||(e.Nu?(o=e.Ju.value.trim(),r=false,s=e.$u.value,o?((c=o.startsWith(":")?0:o.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(o)?o.startsWith("^")||(r=!o.includes("/",c+3),o=(c<0?"^https?://":"^")+(o.startsWith("*")&&"."!==o[1]?"[^/]"+o:(o=o.replace(/\./g,"\\.")).startsWith("*")?o.replace("*\\.","(?:[^./]+\\.)*?"):o.replace("://*\\.","://(?:[^./]+\\.)*?"))):(r=!o.includes("/",c+3)&&!o.startsWith("vimium:"),o=(c<0?":http://":":")+(o=o.replace(/\\(.)/g,"$1")))),r&&(o+="/"),s&&((a=(s=u.r.Vn(s)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z][\da-z]+|[^\sA-Z])>|\S/g))&&((l="^"===a[0]&&a.length>1)&&a.shift(),a.sort(),l?a.unshift("^"):"^"===a[0]&&(a.shift(),a.push("^"))),s=(s=a?a.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),e.$u.title!==(f=s?s.length>1&&"^"===s[0]?"only hook such keys":"pass through such keys":"completely disabled")&&(e.$u.title=f),this.Au(e,o,s),h.push(e.Tu)):this.Au(e,"",s)):e.Tu.pattern&&h.push(e.Tu));return h},i.prototype.Au=function(t,n,e){var o=!t.Tu.passKeys&&!!e;t.Tu={pattern:n,passKeys:e},t.Nu=false,o&&i.ju(t)},i.prototype.ru=function(){var t,n,i,e;for(t=0,n=this.$t;t<n.length;t++)(i=n[t]).gi&&(i.Ju.value!==i.Tu.pattern&&(i.Ju.value=i.Tu.pattern),e=i.Tu.passKeys.trim(),i.$u.value!==e&&(i.$u.value=e))},i})(_),P=S<48||devicePixelRatio<2&&S>=61?function(){var t=document.createElement("style"),n=devicePixelRatio,i=S>=61&&n>=1,e=i||S>=48?1/n:1;e=(""+(e+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=i?"input, textarea { border-width: "+e+"px; }":"* { border-width: "+e+"px !important; }",document.head.appendChild(t)}:null,location.pathname.toLowerCase().includes("/popup.html")&&Promise.all([u.r.pn("Exclusions"),u.r.Wn(1),N.$e&&N.$e()]).then((function(t){return function(){chrome.tabs.query({currentWindow:true,active:true},t)}})(function(n){function i(t){var n,i,e=3===A,o=e?m.g(R,p):m.d(R,p,Z.mu(true));o&&(o=(function(t){var n,i,e,o;for((n=(t=t.trim()).startsWith("^"))&&(t=t.slice(1).trimLeft()),i=Object.create(null),e=0,o=t.split(" ");e<o.length;e++)i[o[e]]=1;return(n?"^ ":"")+Object.keys(i).sort().join(" ")})(o)),t&&($=A>=2?o:null),A=2,n=o===$,i=!!o&&o.length>2&&"^"===o[0],x.textContent=(e?o?s("o137")+s(i?"o138":"o139"):s("o140"):s(n?"o141":"o142")+s(o?i?"o138":"o139":n?"o143":"o143_2")).replace(" to be","")+s("colon")+(o?s("NS"):""),b.className=o?"code":"fixed-width",b.textContent=o?i?o.slice(2):o:s(null!==o?"o144":"o145")+s("o146"),k.textContent=M&&!e&&n?s("o147",[s(0!==j?"o144":"o145")]):M?s("o148"):"",g.disabled=n,g.firstChild.data=s(n?"o115":"o115_2")}function e(){if(!g.disabled){var t=m.e;u.a.or("reset silent",p.t),Z.vu(),setTimeout(function(){m.e=t},50),A=3,i(true),g.firstChild.data=s("o115_3"),g.disabled=true,T=true}}function o(t,n){n&&n.preventDefault(),u.a.or(t.toLowerCase(),p.t),window.close()}var r,c,a,l,f,h,d,v,m,p,w,x,g,b,k,R,S,T,$,j,A,L,K,D,E,U,z,M,W,B,Z,q=n[0],C=q.url,F=u.a.Se(q.id),G=t("#blocked-msg"),H=!(F||q&&C&&"loading"===q.status&&/^(ht|s?f)tp/.test(C));if(H?(r=document.body,c=document.documentElement,r.innerText="",G.style.display="",G.querySelector(".version").textContent=N.$.qe,a=G.querySelector("#refresh-after-install"),q&&C&&/^(ht|s?f)tp/i.test(C)||a.remove(),r.style.width="auto",r.appendChild(G),null==(f=(l=C.startsWith(location.protocol)&&!C.startsWith(location.origin)?new URL(C).host:"")?N.fe[l]:null)||f||((h=t("#injection-refused")).style.display="",h.nextElementSibling.remove(),t("#doAllowExt").onclick=function(){var t,n=N.de("extAllowList"),i=n.split("\n"),e=l;i.indexOf(e)<0&&(t=i.indexOf("# "+e)+1||i.indexOf("#"+e)+1,i.splice(t?t-1:i.length,t?1:0,e),n=i.join("\n"),N.he("extAllowList",n)),this.onclick=null,chrome.tabs.query({active:true,currentWindow:true},function(t){var n=function(){return setTimeout(function(){return location.reload()},500),chrome.runtime.lastError};return t&&t[0]?chrome.tabs.reload(t[0].id,n):chrome.tabs.reload(n),chrome.runtime.lastError})}),c.classList.toggle("auto-dark",!!N.ue.d),c.style.height=""):O(function(t){G.remove(),G=null;var n=document.documentElement.classList;n.toggle("auto-dark",!!N.ue.d),n.toggle("less-motion",!!N.ue.m),t.textContent=N.$.qe},t(".version")),(d=t(".options-link")).href!==(v=N.$.Ge)&&(d.href=v),d.onclick=function(t){t.preventDefault();var n=u.Object.create(null);n.u=N.$.Ge,u.a.qr(n),window.close()},!H){for(m=u.Exclusions,p=!F||F[0].s.i&&!u.r.W.test(F[0].s.u)?{i:0,a:q.incognito,s:0,f:0,t:q.id,u:C}:F[0].s,w=p.i&&((u.a.Se(q.id,0)||{}).s||{}).u||"",x=t("#state-action"),g=t("#saveOptions"),k=(b=x.nextElementSibling).nextElementSibling,R=p.u,S=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return y(n,t),n.prototype.ku=function(i,e){t.prototype.ku.call(this,n.Lu(),e)},n.prototype.Pu=function(t){if(!t)return false;var n=m.e[t];return!(1===n.t?!R.startsWith(n.v)||w&&!w.startsWith(n.v):!n.v.test(R)||w&&!n.v.test(w))},n.prototype.au=function(e){var o,u,r,s;t.prototype.au.call(this,e),(o=this).au=null,document.documentElement.style.height="",n.prototype.Pu=J.prototype.Pu,u=o.$t.filter(function(t){return t.gi}),A=(r=u.length>0)?2:1,r?(s=u[0].$u,i(true)):(o.ku("",false),s=o.$t[o.$t.length-1].$u),O(function(){return s.focus()})},n.prototype.Au=function(n,i,e){var o,u,r=n.Tu.pattern===i;t.prototype.Au.call(this,n,i,e),r||(o=m.l(i,""),u=n.Ju,(1===o.t?R.startsWith(o.v):o.v.test(R))?u.title=u.style.color="":(u.style.color="red",u.title="Red text means that the pattern does not\nmatch the current URL."))},n.Lu=function(){var t=R.startsWith("http:")?"^https?://"+R.split("/",3)[2].replace(/[.[\]]/g,"\\$&")+"/":R.startsWith(location.origin)?":vimium:/"+new URL(R).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(R)&&!R.startsWith("file:")?":"+R.split("/",3).join("/")+"/":":"+R;return n.Lu=function(){return t},t},n})(J),T=true,$=null,j=-1,A=0,g.onclick=e,document.addEventListener("keyup",function(t){if(13===t.keyCode&&(t.ctrlKey||t.metaKey)&&(setTimeout(window.close,300),!T))return e()}),L=N.de("exclusionRules"),K=m.e=u.Object.create(null),D=m.Vr,E=0,U=L.length;E<U;E++)K[L[E].pattern]=D[E];z=2!==p.s?"Disable":"Enable",j=(M=!!(1&p.f))?p.s:-1,W=t("#toggleOnce"),B=W.nextElementSibling,O(function(){W.firstElementChild.textContent=(s(z)||z)+(M?"":s("Once")),W.onclick=o.bind(null,z),b.id="state-value",M?(B.classList.remove("hidden"),B.firstElementChild.onclick=o.bind(null,"Reset")):B.remove()}),N.ue.o||window.addEventListener("keydown",function(t){t.altKey&&(88===t.keyCode||M&&90===t.keyCode)&&!(t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.stopImmediatePropagation(),o(88===t.keyCode?z:"Reset"))}),_.cu=false,Z=null,(Z=new S(t("#exclusionRules"),function(){if(T){T=false;var n=t("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),g.removeAttribute("disabled"),g.firstChild.data=s("o115_2")}i(A<2)})).su(),window.onunload=function(){m.e=null,u.r.Wn(-1)},P&&O(P)}}));